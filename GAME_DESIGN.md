# MapleStory Idle - 게임 기획문서

## 1. 개요

| 항목 | 내용 |
|------|------|
| 장르 | 방치형 사냥 게임 |
| 엔진 | PixiJS |
| 플랫폼 | PC 브라우저 |
| 저장 | LocalStorage |
| 리소스 | MapleStory.IO API (몬스터, 아이템, 맵 이미지) |

## 2. 게임 흐름

```
[캐릭터 생성] → [메인 화면 (단일 페이지)]
                     │
         ┌──────────┴──────────┐
         │                     │
    [사냥 자동 진행]      [정비 UI 오버레이]
    (항상 백그라운드)     (캐릭터 슬롯 클릭)
```

## 3. 단일 페이지 구조

모든 게임 활동이 하나의 화면에서 이루어집니다.

### 3.1 화면 구성

**상단 영역 (파티 + 정보)**
- 맵 타이틀 + 맵 변경 버튼
- 공통 메소 표시
- 캐릭터 슬롯 4개 (파티)

**하단 영역 (사냥 필드)**
- 몬스터 스폰 및 이동
- 데미지 표시
- 드롭 및 로그

### 3.2 자동 사냥

사냥은 항상 백그라운드에서 진행됩니다.

**동작 방식:**
- 캐릭터는 상단 슬롯에서 제자리 공격 모션
- 각 캐릭터가 개별적으로 몬스터 공격
- 몬스터는 하단 필드에서 스폰/이동
- 드롭 아이템/메소/경험치 자동 획득

**제약:**
- 브라우저가 열려있을 때만 진행 (오프라인 미지원)

### 3.3 정비 활동

캐릭터 슬롯 클릭 시 해당 캐릭터의 정비 UI가 오버레이로 표시됩니다.

| 활동 | 설명 |
|------|------|
| 능력치 분배 | 레벨업 시 획득한 스탯 포인트 배분 |
| 스킬 분배 | 스킬 포인트로 스킬 습득/강화 |
| 장비 장착 | 드롭 아이템 착용/해제 |
| 상점 | 포션, 소비 아이템 구매 |
| 주문서 강화 | 장비에 주문서 사용 |

## 4. 파티 시스템

### 4.1 파티 구성

| 항목 | 값 |
|------|-----|
| 최대 파티원 | 4명 |
| 최소 파티원 | 1명 |
| 메소 | 파티 공유 (공통 자산) |
| 인벤토리 | 개별 (각 캐릭터) |

### 4.2 캐릭터 슬롯

각 캐릭터 슬롯에 표시되는 정보:

| 요소 | 설명 |
|------|------|
| 캐릭터 스프라이트 | 제자리 공격 모션 |
| HP 바 | 현재/최대 HP |
| MP 바 | 현재/최대 MP |
| EXP 바 | 현재 레벨 경험치 % |
| 스킬 슬롯 | 8개 (액티브 스킬 배치) |

### 4.3 빈 슬롯

캐릭터가 없는 슬롯은 [+] 버튼으로 표시되며, 클릭 시 캐릭터 생성 UI가 열립니다.

---

## 5. 캐릭터 시스템

### 5.1 기본 능력치

| 능력치 | 약자 | 효과 |
|--------|------|------|
| 힘 | STR | 전사/해적(인파이터) 주 스탯 |
| 민첩 | DEX | 궁수/해적(건슬링거) 주 스탯 |
| 지능 | INT | 마법사 주 스탯 |
| 행운 | LUK | 도적 주 스탯 |
| HP | - | 체력, 0 되면 사망 |
| MP | - | 마나, 스킬 사용 시 소모 |

**참고:** 능력치는 해당 직업의 공격력 계산에만 사용됩니다. 명중/회피/크리티컬/드롭률은 별도 시스템으로 처리됩니다.

### 5.2 레벨업 보상

| 보상 | 수량 |
|------|------|
| 능력치 포인트 | 5 |
| 스킬 포인트 | 3 |

### 5.3 직업 시스템

메이플스토리 직업 체계 기반

```
초보자 (Lv.1~10)
    │
    ├─ 전사 (Lv.10) ─┬─ 파이터 (Lv.30) ─ 크루세이더 (Lv.70) ─ 히어로 (Lv.120)
    │                ├─ 페이지 (Lv.30) ─ 나이트 (Lv.70) ─ 팔라딘 (Lv.120)
    │                └─ 스피어맨 (Lv.30) ─ 드래곤나이트 (Lv.70) ─ 다크나이트 (Lv.120)
    │
    ├─ 마법사 (Lv.8) ─┬─ 위자드(불/독) (Lv.30) ─ 메이지(불/독) (Lv.70) ─ 아크메이지(불/독) (Lv.120)
    │                 ├─ 위자드(썬/콜) (Lv.30) ─ 메이지(썬/콜) (Lv.70) ─ 아크메이지(썬/콜) (Lv.120)
    │                 └─ 클레릭 (Lv.30) ─ 프리스트 (Lv.70) ─ 비숍 (Lv.120)
    │
    ├─ 궁수 (Lv.10) ─┬─ 헌터 (Lv.30) ─ 레인저 (Lv.70) ─ 보우마스터 (Lv.120)
    │                └─ 사수 (Lv.30) ─ 저격수 (Lv.70) ─ 신궁 (Lv.120)
    │
    ├─ 도적 (Lv.10) ─┬─ 어쌔신 (Lv.30) ─ 허밋 (Lv.70) ─ 나이트로드 (Lv.120)
    │                └─ 시프 (Lv.30) ─ 시프마스터 (Lv.70) ─ 섀도어 (Lv.120)
    │
    └─ 해적 (Lv.10) ─┬─ 인파이터 (Lv.30) ─ 버커니어 (Lv.70) ─ 바이퍼 (Lv.120)
                     └─ 건슬링거 (Lv.30) ─ 발키리 (Lv.70) ─ 캡틴 (Lv.120)
```

**전직 조건:**
- 해당 레벨 도달
- 전직 퀘스트 완료 (선택적)

## 6. 전투 시스템

### 6.1 데미지 공식

```
기본 공격력 = (무기 공격력) × (주 스탯 / 100 + 1)
스킬 데미지 = 기본 공격력 × 스킬 배율
최종 데미지 = 스킬 데미지 × 크리티컬 배율 (크리 발동 시)
```

**직업별 주 스탯:**
- 전사: STR
- 마법사: INT
- 궁수: DEX
- 도적: LUK
- 해적(인파이터): STR
- 해적(건슬링거): DEX

### 6.2 전투 스탯

| 스탯 | 기본값 | 증가 요소 |
|------|--------|----------|
| 명중률 | 100% | 장비, 스킬 |
| 회피율 | 0% | 장비, 스킬 |
| 크리티컬 확률 | 0% | 장비, 스킬 |
| 크리티컬 데미지 | 150% | 장비, 스킬 |
| 드롭률 | 100% | 장비, 스킬 (배율) |

**참고:** 명중/회피/크리티컬/드롭률은 능력치(STR/DEX/INT/LUK)와 무관하며, 장비 옵션이나 스킬로만 증가합니다.

### 6.3 사망 페널티

| 항목 | 내용 |
|------|------|
| 상태 | 정비 상태로 강제 귀환 |
| 경험치 | 현재 레벨 경험치의 10% 감소 |
| 아이템 | 드롭 없음 (손실 없음) |

## 7. 사냥터 시스템

### 7.1 필드 선택 규칙

```
선택 가능 필드 레벨 = 1 ~ (캐릭터 레벨 + 5)
```

- 상방 제한: 자신 레벨 +5까지
- 하방 제한: 없음 (레벨 1 필드부터 가능)

### 7.2 필드 레벨 산정

- 필드 레벨 = 해당 필드에 스폰되는 몬스터 평균 레벨
- MapleStory.IO API의 맵 데이터 기반

### 7.3 몬스터 스폰

| 등급 | 스폰 주기 | 특징 |
|------|----------|------|
| 일반 | 2~3초 | 기본 드롭 |
| 엘리트 | 60초 | 드롭률 2배, 체력 5배 |
| 보스 | 5분 | 드롭률 10배, 체력 50배, 특수 아이템 |

### 7.4 레벨 차이 보정

| 레벨 차이 | 경험치 배율 | 드롭률 배율 |
|----------|------------|------------|
| 몹 레벨 > 캐릭터 + 5 | 진입 불가 | - |
| 몹 레벨 = 캐릭터 ± 2 | 100% | 100% |
| 몹 레벨 < 캐릭터 - 5 | 50% | 100% |
| 몹 레벨 < 캐릭터 - 10 | 10% | 50% |
| 몹 레벨 < 캐릭터 - 20 | 1% | 10% |

## 8. 아이템 시스템

### 8.1 아이템 분류

| 분류 | 예시 |
|------|------|
| 장비 | 무기, 방어구, 악세서리 |
| 소비 | 포션, 버프 아이템 |
| 기타 | 주문서, 재료 |

### 8.2 장비 등급

| 등급 | 색상 | 추가 옵션 |
|------|------|----------|
| 일반 | 흰색 | 기본 스탯만 |
| 레어 | 파랑 | +1~2 랜덤 옵션 |
| 에픽 | 보라 | +2~3 랜덤 옵션 |
| 유니크 | 노랑 | +3~4 랜덤 옵션 |

### 8.3 주문서 강화

**기본 규칙:**
- 장비마다 업그레이드 가능 횟수(슬롯)가 정해져 있음
- 주문서 사용 시 성공/실패 관계없이 슬롯 1 소모
- 성공률, 파괴 여부는 각 주문서마다 개별 설정

**주문서 속성:**

| 속성 | 설명 |
|------|------|
| 성공률 | 주문서마다 다름 (10%, 30%, 60%, 70%, 100% 등) |
| 능력치 | 성공 시 부여되는 스탯 (STR+3, 공격력+2 등) |
| 파괴 여부 | 실패 시 장비 파괴 가능 여부 (주문서마다 다름) |

**예시 주문서:**

| 주문서 | 성공률 | 효과 | 실패 시 |
|--------|--------|------|--------|
| 한손검 공격력 주문서 60% | 60% | 공격력 +2 | 슬롯만 소모 |
| 한손검 공격력 주문서 10% | 10% | 공격력 +5 | 장비 파괴 가능 |
| 투구 지력 주문서 100% | 100% | INT +1 | - |
| 장갑 민첩 주문서 70% | 70% | DEX +2 | 슬롯만 소모 |

**장비 슬롯:**
- 일반 장비: 5~7 슬롯
- 레어 이상: 추가 슬롯 가능

## 9. 상점 시스템

### 9.1 구매 가능 아이템

| 아이템 | 가격 | 효과 |
|--------|------|------|
| 빨간 포션 | 50 | HP +50 |
| 주황 포션 | 200 | HP +150 |
| 흰 포션 | 500 | HP +300 |
| 파란 포션 | 50 | MP +50 |
| 마나 엘릭서 | 500 | MP +300 |
| 만병통치약 | 1000 | HP/MP 전체 회복 |

### 9.2 자동 포션

정비 상태에서 설정 가능:
- HP가 N% 이하일 때 자동 사용
- 사용할 포션 종류 선택

## 10. 스킬 시스템

### 10.1 스킬 분류

| 분류 | 설명 |
|------|------|
| 패시브 | 상시 적용, 스탯 증가 등 |
| 액티브 | 쿨타임 기반 자동 시전 |

### 10.2 스킬 시전

- 스킬은 쿨타임 돌아오면 자동 시전
- 우선순위 설정 가능 (선택적)
- MP 부족 시 기본 공격

## 11. UI 구성

### 11.1 메인 화면 (단일 페이지)

```
┌─────────────────────────────────────────────────────────────┐
│  [돼지의 해안가 ▼]                        [메소: 12,340]    │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
│ │  [캐릭터1]  │ │  [캐릭터2]  │ │   [빈칸]    │ │   [빈칸]    │ │
│ │  (공격모션) │ │  (공격모션) │ │             │ │             │ │
│ │ HP ████████ │ │ HP ██████   │ │    [+]      │ │    [+]      │ │
│ │ MP ██████   │ │ MP ████     │ │  캐릭터     │ │  캐릭터     │ │
│ │ EXP ███████ │ │ EXP █████   │ │   추가      │ │   추가      │ │
│ │[1][2][3][4] │ │[1][2][3][4] │ │             │ │             │ │
│ │[5][6][7][8] │ │[5][6][7][8] │ │             │ │             │ │
│ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│          [몹]      [몹]           [몹]                      │
│               [몹]        [몹]         [몹]                 │
│                      [몹]                                   │
│                                                             │
│  경험치 획득! +15 EXP                                       │
│  +23 메소                                                   │
│  돼지의 가죽 획득!                                          │
└─────────────────────────────────────────────────────────────┘
```

### 11.2 상단 영역 구성

| 요소 | 설명 |
|------|------|
| 맵 타이틀 | 현재 맵 이름 + 변경 버튼 (▼) |
| 메소 | 파티 공통 자산 |
| 캐릭터 슬롯 x4 | 파티원 표시 (빈 슬롯은 [+] 버튼) |

### 11.3 캐릭터 슬롯 상세

```
┌─────────────────┐
│   [스프라이트]  │  ← 제자리 공격 모션
│   Lv.45 전사    │  ← 레벨 + 직업
│                 │
│ HP ████████░░   │  ← 체력 바
│ MP ██████░░░░   │  ← 마나 바
│ EXP ███████░░░  │  ← 경험치 바
│                 │
│ [1][2][3][4]    │  ← 스킬 슬롯 (8개)
│ [5][6][7][8]    │
└─────────────────┘
```

**상호작용:**
- 슬롯 클릭: 캐릭터 정비 UI 오버레이 (스탯, 장비, 스킬)
- 스킬 슬롯 클릭: 스킬 사용 또는 스킬 배치 UI

### 11.4 하단 영역 (사냥 필드)

| 요소 | 설명 |
|------|------|
| 몬스터 | 스폰/이동/피격/사망 애니메이션 |
| 데미지 표시 | 메이플 스타일 숫자 (스태킹) |
| 로그 영역 | 경험치/메소/아이템 획득 로그 |

### 11.5 정비 UI (오버레이)

캐릭터 슬롯 클릭 시 해당 캐릭터의 정비 UI가 오버레이로 표시됩니다.

```
┌─────────────────────────────────────────┐
│  [X]  캐릭터명 - Lv.45 전사             │
├─────────────────────────────────────────┤
│ [스탯] [장비] [스킬] [인벤토리]          │
├─────────────────────────────────────────┤
│                                         │
│   ┌─────────┐    STR: 125 (+5)         │
│   │ 캐릭터  │    DEX: 45               │
│   │ 미리보기│    INT: 20               │
│   │         │    LUK: 35               │
│   └─────────┘                          │
│                  남은 스탯 포인트: 15   │
│                                         │
└─────────────────────────────────────────┘
```

## 12. 데이터 저장

### 12.1 LocalStorage 구조

```json
{
  "party": {
    "meso": "number",
    "currentMapId": "number",
    "characters": [
      {
        "id": "string",
        "name": "string",
        "level": "number",
        "exp": "number",
        "job": "string",
        "stats": { "str": 0, "dex": 0, "int": 0, "luk": 0 },
        "statPoints": "number",
        "skillPoints": "number",
        "hp": "number",
        "maxHp": "number",
        "mp": "number",
        "maxMp": "number",
        "inventory": {
          "equip": {},
          "use": {},
          "etc": {}
        },
        "equipment": {
          "weapon": null,
          "hat": null,
          "top": null,
          "bottom": null,
          "shoes": null,
          "gloves": null,
          "cape": null,
          "accessory": null
        },
        "skills": {},
        "skillSlots": [null, null, null, null, null, null, null, null],
        "settings": {
          "autoPotionHp": 30,
          "autoPotionType": "white_potion"
        }
      }
    ]
  },
  "statistics": {
    "totalKills": 0,
    "totalDeaths": 0,
    "playTime": 0
  }
}
```

**구조 설명:**
- `party.meso`: 파티 공통 메소 (공유)
- `party.currentMapId`: 현재 사냥 중인 맵
- `party.characters`: 파티원 배열 (최대 4명)
- 각 캐릭터는 개별 인벤토리, 장비, 스킬 보유

## 13. 기술 스택

| 항목 | 기술 |
|------|------|
| 렌더링 | PixiJS |
| 언어 | TypeScript |
| 빌드 | Vite |
| 상태관리 | Zustand (또는 자체 구현) |
| API | MapleStory.IO |

## 14. 개발 우선순위

### Phase 1: MVP
- [ ] 캐릭터 생성 (초보자만)
- [ ] 기본 사냥 루프 (자동 공격)
- [ ] 몬스터 스폰/처치
- [ ] 경험치/레벨업
- [ ] 기본 UI

### Phase 2: 핵심 시스템
- [ ] 직업 시스템 (1차 전직)
- [ ] 스킬 시스템
- [ ] 아이템 드롭/장착
- [ ] 상점/포션

### Phase 3: 확장
- [ ] 2~4차 전직
- [ ] 주문서 강화
- [ ] 장비 등급 시스템
- [ ] 보스 몬스터

### Phase 4: 폴리싱
- [ ] 이펙트/애니메이션
- [ ] 사운드
- [ ] 업적 시스템
- [ ] 통계/랭킹

---

## 15. 구현 완료 시스템 (Demo)

### 15.1 사냥터 필드 시스템

**몬스터 스폰**
| 항목 | 값 | 설명 |
|------|-----|------|
| 최대 마리수 | 15 | 전역 설정 (config.ts) |
| 스폰 주기 | 2초 | 전역 설정 |
| 페이드인 시간 | 1초 | 스폰 시 투명→불투명 |

**몬스터 행동 패턴**
| 행동 | 확률 | 설명 |
|------|------|------|
| 이동 (좌/우) | 60% | 몬스터별 속도 적용 |
| 정지 | 30% | stand 애니메이션 |
| 점프 | 10% | canJump=true인 몬스터만 |

**몬스터 속성**
- 이동 속도: 몬스터 JSON의 `meta.speed` 사용
- 점프 가능: 몬스터 JSON의 `canJump` 속성
- 방향 전환: 이동 방향에 따라 스프라이트 좌우 반전

### 15.2 전투 시스템 (테스트용)

**공격 방식**
- 화면 클릭 시 랜덤 몬스터 공격
- 죽어가는 몬스터는 타겟팅 제외

**데미지 계산**
| 타입 | 데미지 범위 | 확률 |
|------|------------|------|
| 일반 | 10 ~ 30 | 70% |
| 크리티컬 | 25 ~ 50 | 30% |

**피격 시스템**
| 항목 | 값 |
|------|-----|
| 피격 경직 | 450ms |
| 피격 애니메이션 | hit1.gif |
| 사망 애니메이션 | die1.gif |
| 사망 페이드아웃 | 600ms |

### 15.3 데미지 표시 시스템

**스타일 (메이플스토리 스타일)**
| 타입 | 폰트 색상 | 테두리 색상 | 크기 |
|------|----------|------------|------|
| 일반 | 주황색 (0xFFA040) | 진한 빨강 (0xAA2200) | 26px |
| 크리티컬 | 분홍색 (0xFF6090) | 진한 분홍 (0x990050) | 30px |

**애니메이션 효과**
- 각 숫자 개별 바운스 (순차 등장, 25ms 딜레이)
- 위로 떠오르며 페이드아웃 (1초)
- 크리티컬: 더 큰 바운스 + 흔들림 효과

**스태킹 시스템**
| 항목 | 값 | 설명 |
|------|-----|------|
| 스택 높이 | 35px | 연속 데미지 간격 |
| 리셋 시간 | 600ms | 이 시간 후 스택 초기화 |

### 15.4 사운드 시스템

**BGM**
- MapleStory.IO WZ API에서 로드
- 경로 형식: `Sound/{folder}.img/{name}` (예: `Bgm02/AboveTheTreetops`)
- 자동재생 차단 시 사용자 인터랙션 후 자동 재개

**몬스터 효과음**
| 타입 | 경로 형식 | 설명 |
|------|----------|------|
| 피격 | `Sound/Mob.img/{mobId}/Damage` | 7자리 ID (앞에 0 패딩) |
| 사망 | `Sound/Mob.img/{mobId}/Die` | 7자리 ID (앞에 0 패딩) |

**아이템 효과음**
- 경로: `Sound/Game.img/PickUpItem`
- 아이템 획득 시 재생 (겹침 허용)

### 15.5 로그 시스템

**위치 및 스타일**
- 맵 타이틀 하단 (y=70)
- 최대 10줄, 밀어내기 방식

**페이드 효과**
| 항목 | 값 |
|------|-----|
| 표시 유지 | 3초 |
| 페이드아웃 | 2초 |

**로그 종류 및 색상**
| 타입 | 색상 | 포맷 |
|------|------|------|
| 경험치 | 연녹색 (0x90EE90) | `{몬스터명} 처치! +{exp} EXP` |
| 메소 | 금색 (0xFFD700) | `+{amount} 메소` |
| 아이템 | 하늘색 (0x87CEEB) | `{아이템명} 획득!` |

### 15.6 드롭 시스템

**메소 드롭**
- 비주얼 없음, 로그로만 표시
- 드롭 확률: 몬스터 JSON의 `meso.chance`
- 금액 범위: 기본값 ±20%

**아이템 드롭**
- 아이콘 비주얼 + 로그 표시
- 드롭 확률: 각 아이템의 `chance` 값
- 애니메이션: 몬스터 위치에서 화면 중앙으로 날아가며 사라짐

### 15.7 몬스터 UI

**HP 바**
| 항목 | 값 |
|------|-----|
| 색상 | 빨간색 |
| 크기 | 48x4 px |
| 표시 조건 | 피격 시에만 표시 |
| 위치 | 몬스터 상단 |

**이름표**
- 형식: `Lv.{level} {name}`
- 위치: 몬스터 하단

### 15.8 에셋 관리 시스템 (AssetManager)

**캐싱 지원 타입**
| 타입 | 캐시 키 형식 | 설명 |
|------|-------------|------|
| 몬스터 GIF | `mob_{id}_{animation}` | stand, move, hit1, die1 |
| BGM | `bgm_{path}` | base64 인코딩 |
| 몬스터 사운드 | `mobSound_{id}_{type}` | Damage, Die |
| 게임 사운드 | `gameSound_{path}` | PickUpItem 등 |
| 이미지 | `{type}_{id}_{variant}` | 아이템 아이콘 등 |

**싱글톤 패턴**
- `AssetManager.getInstance()`로 접근
- 중복 요청 방지 (로딩 중 Promise 재사용)

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-01-30 | 단일 페이지 레이아웃으로 전면 변경, 파티 시스템(4인) 추가 |
| 2026-01-30 | 구현 완료 시스템 문서화 (사냥터, 전투, UI, 사운드, 로그) |
| 2026-01-29 | 초안 작성 |
